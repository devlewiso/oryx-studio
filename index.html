<!DOCTYPE html>

<html lang="es">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ORYX Studio - Conversor de Lenguaje Natural a ORYX</title>

    <!-- Tailwind CSS CDN -->

    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Incluir fuente Inter -->

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

    

    <!-- Prism.js CSS (Tema Oscuro para Syntax Highlighting) -->

    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-dark.min.css" rel="stylesheet" />



    <style>

        /* Variables y Estilos Base */

        :root {

            --primary: #00A8E8; /* Cyan principal */

            --accent: #00D4FF; /* Aqua brillante */

            --dark-bg: #0F1419;

            --card-bg: #1A1F2E;

            --border: #2A3142;

            --success: #10B981; /* Verde esmeralda */

            --error: #EF4444; /* Rojo fuerte */

        }



        body {

            font-family: 'Inter', sans-serif;

            background-color: var(--dark-bg);

            color: #E8ECEF;

            min-height: 100vh;

            display: flex;

            flex-direction: column;

        }



        /* Estilos espec铆ficos del Header/Logo */

        .logo-text {

            background: linear-gradient(135deg, var(--primary), var(--accent));

            -webkit-background-clip: text;

            -webkit-text-fill-color: transparent;

            background-clip: text;

        }



        /* Estilos del 谩rea de trabajo */

        .workspace {

            display: grid;

            grid-template-columns: 1fr;

            gap: 1.5rem;

        }



        @media (min-width: 1024px) {

            .workspace {

                grid-template-columns: repeat(3, 1fr);

            }

        }



        /* Estilos del Panel de C贸digo */

        .code-panel {

            background-color: var(--card-bg);

            border: 1px solid var(--border);

            transition: all 0.3s ease;

        }



        .code-panel:hover {

            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.1);

        }



        /* Textareas y Pre (Contenedores de C贸digo) */

        textarea, pre {

            background-color: #0F1419;

            border: 1px solid #2A3142;

            font-family: 'Courier New', monospace;

            font-size: 0.875rem;

            min-height: 250px;

            overflow: auto;

            margin: 0 !important; /* Anula margin de Prism */

            padding: 1rem !important; /* Anula padding de Prism */

        }



        /* Resaltado de Sintaxis para ORYX */

        .language-oryx {

            color: #E8ECEF; /* Blanco principal */

        }

        .language-oryx .token.property,

        .language-oryx .token.selector,

        .language-oryx .token.comment {

            color: var(--accent); /* Claves ORYX en aqua */

        }

        .language-oryx .token.boolean,

        .language-oryx .token.number {

            color: var(--primary); /* N煤meros/Bool en cyan */

        }

        .language-oryx .token.string {

            color: var(--success); /* Strings en verde */

        }



        /* Resaltado de Sintaxis para JSON (Prism default es bueno, pero lo ajustamos) */

        #jsonOutput.language-json {

            color: #E8ECEF;

        }



        /* Color de error para el borde del ORYX */

        .error-border {

            border: 2px solid var(--error) !important;

            box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);

        }



        /* Estilos del bot贸n de acci贸n */

        .btn-primary {

            background: linear-gradient(135deg, var(--primary), var(--accent));

            color: var(--dark-bg);

            font-weight: 700;

            transition: all 0.3s ease;

            box-shadow: 0 5px 15px rgba(0, 168, 232, 0.3);

        }



        .btn-primary:hover {

            opacity: 0.9;

            transform: translateY(-2px);

            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.5);

        }



        /* Indicador de carga */

        .spinner {

            border: 4px solid rgba(255, 255, 255, 0.1);

            border-left-color: var(--accent);

            border-radius: 50%;

            width: 1.5rem;

            height: 1.5rem;

            animation: spin 1s linear infinite;

        }



        @keyframes spin {

            to { transform: rotate(360deg); }

        }



        /* Estilo para los botones de descarga */

        .download-btn {

            background-color: var(--border);

            color: #E8ECEF;

            transition: background-color 0.2s;

        }



        .download-btn:hover {

            background-color: var(--primary-dark);

        }



        .download-btn-json {

            background-color: var(--success);

            color: var(--dark-bg);

        }

        .download-btn-json:hover {

            background-color: #059669;

        }

    </style>

</head>

<body class="p-4 md:p-8">



    <header class="text-center mb-8">

        <h1 class="4xl font-extrabold mb-2 logo-text">ORYX Studio </h1>

        <p class="text-xl text-gray-400">Traductor de Lenguaje Natural a <span class="text-white font-semibold">ORYX v0.1</span></p>

        <p class="text-sm text-gray-500 mt-2">Convierte descripciones de datos en texto eficiente para ahorrar tokens de API.</p>

    </header>



    <main class="flex-grow">

        <div class="workspace">

            <!-- Panel 1: Entrada de Lenguaje Natural / JSON -->

            <div class="code-panel p-4 rounded-xl">

                <h2 class="text-lg font-bold mb-3 text-white">1. Describe tus Datos</h2>

                <p class="text-xs text-gray-400 mb-3" id="inputDescription">

                    (Modo: Lenguaje Natural) Ej: "Quiero una lista de 5 productos con su id, nombre y precio. Los productos son: Laptop (1, 999.99) y Mouse (2, 25.50)."

                </p>

                <!-- CAMPO DE TEXTO LIMPIO -->

                <textarea id="naturalInput" class="w-full p-3 rounded-lg resize-none" rows="10" placeholder="Describe aqu铆 la estructura de datos que necesitas... o pega tu JSON aqu铆 para la conversi贸n inversa."></textarea>

                

                <div class="flex flex-col gap-2 mt-3">

                    <button id="convertButton" class="btn-primary w-full py-2 rounded-lg flex items-center justify-center gap-2" onclick="handleConversion('natural')">

                        <span id="buttonText"> Generar ORYX (Desde Lenguaje Natural)</span>

                        <div id="spinner" class="spinner hidden"></div>

                    </button>

                    <button id="reverseButton" class="btn-secondary w-full py-2 rounded-lg flex items-center justify-center gap-2 bg-gray-600 hover:bg-gray-700 text-white font-bold" onclick="handleConversion('json')">

                        <span> Convertir ORYX (Desde JSON Pegado)</span>

                    </button>

                </div>

            </div>



            <!-- Panel 2: Salida ORYX (Compresi贸n y Ahorro) -->

            <div class="code-panel p-4 rounded-xl relative">

                <h2 class="text-lg font-bold mb-3 text-white flex justify-between items-center">

                    <span>2. Formato ORYX (Token Eficiente)</span>

                    <span id="tokenSavings" class="text-xs font-normal px-2 py-1 rounded-full bg-green-900 text-green-300 hidden"></span>

                </h2>

                <!-- CAMPOS DE SALIDA VACOS -->

                <pre id="oryxOutput" class="w-full p-3 rounded-lg whitespace-pre-wrap language-oryx"></pre>

                <div class="flex justify-end mt-2">

                    <button id="downloadOryx" class="download-btn px-4 py-1 rounded-lg text-xs" disabled onclick="downloadFile('data.oryx', oryxOutput.textContent)">

                         Descargar .oryx

                    </button>

                </div>

                <p class="text-xs text-gray-400 mt-2">Este formato reduce la redundancia para **maximizar el espacio de tokens** en las llamadas a la API de tu LLM.</p>

            </div>



            <!-- Panel 3: Salida JSON (Validaci贸n y Mapeo) -->

            <div class="code-panel p-4 rounded-xl relative">

                <h2 class="text-lg font-bold mb-3 text-white">3. Estructura JSON (Validaci贸n)</h2>

                <!-- CAMPOS DE SALIDA VACOS -->

                <pre id="jsonOutput" class="w-full p-3 rounded-lg whitespace-pre-wrap language-json"></pre>

                <div class="flex justify-end mt-2">

                    <button id="downloadJson" class="download-btn download-btn-json px-4 py-1 rounded-lg text-xs" disabled onclick="downloadFile('data.json', jsonOutput.textContent)">

                         Descargar .json

                    </button>

                </div>

                <p class="text-xs text-gray-400 mt-2">ORYX garantiza el **Mapeo 1:1** con JSON, asegurando que la estructura de datos sea correcta y universalmente compatible.</p>

            </div>

        </div>

    </main>



    <footer class="mt-8 text-center text-sm text-gray-500 border-t border-gray-800 pt-4">

        <p>ORYX Studio basado en la Especificaci贸n v0.1 (Licencia MIT) | Creado para el ahorro de tokens y la eficiencia. <br>

        *Nota: La tokenizaci贸n es simulada por motivos de entorno (sin acceso a librer铆as de terceros como tiktoken).</p>

    </footer>



    <!-- Prism.js JS -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>

    <script>

        // Definici贸n de lenguaje ORYX (simulado) para Prism

        Prism.languages.oryx = {

            'comment': {

                pattern: /(^|[^\\:])#.*/,

                lookbehind: true,

                greedy: true

            },

            'directive': {

                pattern: /@alias|@block/,

                alias: 'comment'

            },

            'collection-header': {

                pattern: /(\w+)\[\d+\]\{.*?\}:/,

                alias: 'selector'

            },

            'key': {

                pattern: /[\w\s-]+(?=\s*:)/,

                alias: 'property'

            },

            'boolean': /\b(?:true|false)\b/,

            'number': /\b\d+(\.\d+)?\b/,

            'string': {

                pattern: /"(?:\\.|[^"\\])*"/,

                greedy: true

            }

        };



        const apiKey = ""; 

        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;



        // Contenedores de UI

        const naturalInput = document.getElementById('naturalInput');

        const oryxOutput = document.getElementById('oryxOutput');

        const jsonOutput = document.getElementById('jsonOutput');

        const convertButton = document.getElementById('convertButton');

        const reverseButton = document.getElementById('reverseButton');

        const buttonText = document.getElementById('buttonText');

        const spinner = document.getElementById('spinner');

        const tokenSavings = document.getElementById('tokenSavings');

        const downloadOryx = document.getElementById('downloadOryx');

        const downloadJson = document.getElementById('downloadJson');



        // Funci贸n para contar tokens (Proxy para tiktoken)

        function countTokens(text) {

            if (!text) return 0;

            // Proxy robusto: cuenta palabras, n煤meros, delimitadores estructurales y signos de puntuaci贸n.

            return text.match(/[^\\s,;:{}\[\]"']+|[,;:{}\[\]"']/g)?.length || 0;

        }



        // ----------------------------------------------------------------------

        // Prompts para el LLM

        // ----------------------------------------------------------------------



        // Especificaci贸n ORYX v0.1 para guiar la generaci贸n (Modo 1: Natural -> ORYX)

        const ORYX_SPEC_NATURAL = `

            Eres un codificador de datos ORYX v0.1. Tu 煤nica tarea es convertir la descripci贸n de datos en lenguaje natural a la representaci贸n de datos ORYX COMPACTA, utilizando la sintaxis exacta.

            Reglas clave de la sintaxis ORYX v0.1 para la respuesta:

            1. Prioriza la sintaxis tabular (ej: 'coleccion[N]{clave1,clave2}:\n  1, valorA, valorB') para listas de objetos.

            2. Utiliza indentaci贸n de dos espacios.

            3. Aplica el bloque @alias para reducir claves largas (ej: 'productos[N]{i,n,p}'). Si usas alias, def铆nelo primero: '@alias { id:i, nombre:n }'.

            4. No uses comillas a menos que un string contenga comas o caracteres ambiguos.

            5. Genera SOLAMENTE el texto en formato ORYX, sin ninguna explicaci贸n, introducci贸n o texto adicional.

            Ejemplo de salida tabular:

            @alias { id:i, nombre:n }

            usuarios[2]{i,n,activo}:

              1, Luis, true

              2, Ana, false

        `;



        // Prompt para la Conversi贸n Inversa (Modo 2: JSON -> ORYX)

        const ORYX_SPEC_JSON = `

            Eres un codificador de datos ORYX v0.1. Tu 煤nica tarea es convertir la estructura de datos JSON proporcionada a la representaci贸n de datos ORYX COMPACTA, aplicando la m谩xima optimizaci贸n tabular y alias (@alias) para reducir el consumo de tokens.

            Reglas clave de la sintaxis ORYX v0.1 para la respuesta:

            1.  Identifica colecciones de objetos homog茅neos y usa la sintaxis tabular (ej: 'coleccion[N]{clave1,clave2}:\n  1, valorA, valorB').

            2.  Aplica el bloque @alias para cualquier clave que se repita m谩s de dos veces en la colecci贸n.

            3.  Utiliza indentaci贸n de dos espacios.

            4.  Genera SOLAMENTE el texto en formato ORYX, sin ninguna explicaci贸n, introducci贸n o texto adicional.

        `;

        

        // ----------------------------------------------------------------------

        // SIMULACIN DE PARSING ORYX A JSON (Para fines de validaci贸n en la UI)

        // ----------------------------------------------------------------------



        function simulateOryxToJson(oryxText) {

            const lines = oryxText.split('\n').filter(line => line.trim() && !line.trim().startsWith('#'));

            let json = {};

            let currentAlias = {};

            let isParsingTable = false;

            let currentCollection = null;

            let currentKeys = [];



            try {

                for (let line of lines) {

                    line = line.trimStart(); // Respeta indentaci贸n para objetos simples



                    // 1. Manejar Alias

                    if (line.startsWith('@alias')) {

                        const aliasMatch = line.match(/@alias\s*\{(.*?)\}/);

                        if (aliasMatch) {

                            const cleanedAlias = '{' + aliasMatch[1].replace(/(\w+):(\w+)/g, '"$1":"$2"') + '}';

                            currentAlias = JSON.parse(cleanedAlias);

                        }

                        continue;

                    }

                    

                    // 2. Detectar colecciones tabulares (ej: usuarios[2]{id,nombre}:)

                    const collectionMatch = line.match(/^(\w+)\[\d+\]\{(.*?)\}:$/);

                    if (collectionMatch) {

                        currentCollection = collectionMatch[1];

                        currentKeys = collectionMatch[2].split(',').map(k => k.trim());

                        json[currentCollection] = [];

                        isParsingTable = true;

                        continue;

                    }



                    // 3. Parsear filas de colecciones (Indentaci贸n de 2 espacios)

                    if (isParsingTable && line.startsWith('  ') && !line.includes(':')) {

                        const dataLine = line.trim();

                        const values = dataLine.split(',').map(v => v.trim());

                        let obj = {};



                        if (values.length !== currentKeys.length) throw new Error(`Mismatched columns: Expected ${currentKeys.length}, found ${values.length} in row "${dataLine}"`);



                        values.forEach((val, index) => {

                            const key = currentKeys[index];

                            const originalKey = currentAlias[key] || key;

                            let processedValue = val;



                            // Simulaci贸n de inferencia de tipos (m谩s robusta)

                            if (processedValue === 'true') processedValue = true;

                            else if (processedValue === 'false') processedValue = false;

                            else if (processedValue.match(/^-?\d+$/)) processedValue = parseInt(processedValue);

                            else if (processedValue.match(/^-?\d+\.\d+$/)) processedValue = parseFloat(processedValue);

                            else if (processedValue.startsWith('"') && processedValue.endsWith('"')) processedValue = processedValue.slice(1, -1);

                            

                            obj[originalKey] = processedValue;

                        });

                        json[currentCollection].push(obj);

                    } else if (isParsingTable && !line.startsWith('  ') && line.includes(':')) {

                        // Un nuevo bloque comienza sin indentaci贸n, la tabla termina

                         isParsingTable = false;

                         currentCollection = null;

                         currentKeys = [];

                    }

                    

                    // 4. Manejar objetos simples (no anidados)

                    const kvMatch = line.match(/^(\w+):\s*(.*)$/);

                    if (kvMatch && !isParsingTable) {

                        const key = kvMatch[1].trim();

                        const val = kvMatch[2].trim();

                        

                        let processedValue = val;

                        if (processedValue === 'true') processedValue = true;

                        else if (processedValue === 'false') processedValue = false;

                        else if (processedValue.match(/^-?\d+$/)) processedValue = parseInt(processedValue);

                        else if (processedValue.match(/^-?\d+\.\d+$/)) processedValue = parseFloat(processedValue);

                        

                        // A帽ade al nivel superior

                        json[key] = processedValue;

                    }

                }

            } catch (e) {

                console.error("Error en la simulaci贸n de parsing ORYX:", e.message);

                return `{"error": "Simulaci贸n de JSON fallida: ${e.message}. Por favor, revisa la sintaxis ORYX."}`;

            }



            return JSON.stringify(json, null, 2);

        }



        // ----------------------------------------------------------------------

        // L贸gica principal de la aplicaci贸n (Conversi贸n LLM)

        // ----------------------------------------------------------------------



        async function handleConversion(mode) {

            const input = naturalInput.value.trim();

            if (!input) {

                jsonOutput.textContent = "Por favor, ingresa datos para comenzar la conversi贸n.";

                return;

            }



            // Determinar prompt y mensaje

            let systemPrompt;

            let userPrompt;

            if (mode === 'json') {

                systemPrompt = ORYX_SPEC_JSON;

                userPrompt = `Convierte este JSON a ORYX v0.1: \n\n ${input}`;

                buttonText.textContent = "Generando ORYX desde JSON...";

            } else { // mode === 'natural'

                systemPrompt = ORYX_SPEC_NATURAL;

                userPrompt = `Convierte esta descripci贸n a ORYX v0.1: ${input}`;

                buttonText.textContent = "Generando ORYX desde Lenguaje Natural...";

            }



            // UI: Iniciar carga

            convertButton.disabled = true;

            reverseButton.disabled = true;

            spinner.classList.remove('hidden');

            oryxOutput.textContent = "";

            jsonOutput.textContent = "";

            tokenSavings.classList.add('hidden');

            oryxOutput.classList.remove('error-border');

            downloadOryx.disabled = true;

            downloadJson.disabled = true;



            // 1. Llamada a la API de Gemini con reintentos

            let resultText = "Error al generar el formato ORYX.";

            let attempt = 0;

            const maxAttempts = 3;



            while (attempt < maxAttempts) {

                try {

                    const payload = {

                        contents: [{ parts: [{ text: userPrompt }] }],

                        systemInstruction: { parts: [{ text: systemPrompt }] },

                    };



                    const response = await fetch(apiUrl, {

                        method: 'POST',

                        headers: { 'Content-Type': 'application/json' },

                        body: JSON.stringify(payload)

                    });



                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);



                    const result = await response.json();

                    resultText = result.candidates?.[0]?.content?.parts?.[0]?.text || "Error: Respuesta vac铆a o inesperada.";

                    break; 



                } catch (error) {

                    console.error(`Intento ${attempt + 1} fallido:`, error);

                    attempt++;

                    if (attempt < maxAttempts) {

                        await new Promise(resolve => setTimeout(resolve, Math.pow(2, attempt) * 1000)); // Espera exponencial

                    }

                }

            }



            // 2. Procesar y Resaltar ORYX

            oryxOutput.textContent = resultText;

            Prism.highlightElement(oryxOutput);

            

            // 3. Calcular tokens y validar JSON

            if (!resultText.startsWith("Error")) {

                const oryxTokens = countTokens(resultText); 

                const jsonRepresentation = simulateOryxToJson(resultText);

                jsonOutput.textContent = jsonRepresentation;

                Prism.highlightElement(jsonOutput);

                

                // 4. Manejo de Errores de Simulaci贸n y Ahorro

                if (jsonRepresentation.includes("Simulaci贸n de JSON fallida")) {

                    tokenSavings.textContent = `Ahorro (Simulado): --%`;

                    tokenSavings.classList.remove('bg-green-900', 'text-green-300');

                    tokenSavings.classList.add('bg-red-900', 'text-red-300');

                    oryxOutput.classList.add('error-border'); // Resaltar error

                } else {

                    const jsonTokens = countTokens(jsonRepresentation);

                    const savings = Math.round(((jsonTokens - oryxTokens) / jsonTokens) * 100);

                    

                    tokenSavings.textContent = `Ahorro (Simulado): ${savings}%`;

                    tokenSavings.classList.remove('hidden', 'bg-red-900', 'text-red-300');

                    tokenSavings.classList.add('bg-green-900', 'text-green-300');



                    // Habilitar descargas

                    downloadOryx.disabled = false;

                    downloadJson.disabled = false;

                }

            } else {

                jsonOutput.textContent = "No se pudo validar el JSON debido al error de generaci贸n ORYX.";

                Prism.highlightElement(jsonOutput);

            }



            // UI: Finalizar carga

            convertButton.disabled = false;

            reverseButton.disabled = false;

            spinner.classList.add('hidden');

            

            // Restaurar texto del bot贸n principal

            if (mode === 'natural') {

                buttonText.textContent = " Generar ORYX (Desde Lenguaje Natural)";

            } else {

                buttonText.textContent = " Convertir ORYX (Desde JSON Pegado)";

            }

        }



        // ----------------------------------------------------------------------

        // Funci贸n de Descarga de Archivos

        // ----------------------------------------------------------------------

        function downloadFile(filename, content) {

            const blob = new Blob([content], { type: 'text/plain' });

            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');

            a.href = url;

            a.download = filename;

            document.body.appendChild(a);

            a.click();

            document.body.removeChild(a);

            URL.revokeObjectURL(url);

        }

    </script>

</body>

</html>
